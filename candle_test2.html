<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Birthday Cake with Blowable Candles</title>
  <style>
    body { display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100vh; background: #ffe6e6; margin: 0; }
    .cake { position: relative; width: 400px; height: 200px; background: #d2691e; border-radius: 20px; box-shadow: inset 0 -20px 0 #a0522d; margin-bottom: 40px; }
    .candle { position: absolute; width: 10px; height: 40px; background: #fffacd; top: -40px; }
    .flame { width: 10px; height: 20px; background: radial-gradient(circle, yellow 0%, orange 60%, rgba(255,165,0,0) 80%); border-radius: 50%; animation: flicker .15s infinite alternate; }
    @keyframes flicker { from { transform: scaleY(1); } to { transform: scaleY(1.1); } }
    .present, .flowers, .letter { width: 100px; height: 100px; margin: 20px; display: inline-block; background-size: cover; cursor: pointer; }
    .present { background-image: url('https://i.imgur.com/w1XQn5B.png'); }
    .flowers { background-image: url('https://i.imgur.com/1tAdVf2.png'); }
    .letter { background-image: url('https://i.imgur.com/zX5I7rR.png'); }
    #letterModal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); color: white; align-items: center; justify-content: center; padding: 20px; }
    #letterModalContent { background: white; color: black; padding: 20px; border-radius: 10px; max-width: 500px; }
    #letterModalContent img { max-width: 100%; height: auto; display: block; }
  </style>
</head>
<body>
  <div class="cake" id="cake"></div>
  <div>
    <div class="letter" id="letter"></div>
    <div class="present"></div>
    <div class="flowers"></div>
  </div>

  <div id="letterModal">
    <div id="letterModalContent">
      <img id="letterImage" src="letter.jpeg" alt="Letter" />
      <button onclick="document.getElementById('letterModal').style.display='none'">Close</button>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  <script>
    const cake = document.getElementById('cake');
    const flames = [];

    for (let i = 0; i < 23; i++) {
      const candle = document.createElement('div');
      candle.className = 'candle';
      candle.style.left = (10 + i * (380 / 22)) + 'px';
      const flame = document.createElement('div');
      flame.className = 'flame';
      candle.appendChild(flame);
      flames.push(flame);
      cake.appendChild(candle);
    }

    // Microphone blow detection
    async function startMic() {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        const source = audioCtx.createMediaStreamSource(stream);
        const analyser = audioCtx.createAnalyser();
        analyser.fftSize = 256;
        const dataArray = new Uint8Array(analyser.frequencyBinCount);
        source.connect(analyser);

        function detectBlow() {
          analyser.getByteFrequencyData(dataArray);
          let avg = dataArray.reduce((a, b) => a + b) / dataArray.length;
          if (avg > 60) { // sensitivity threshold
            flames.forEach(f => f.style.display = 'none');
            confetti({ particleCount: 200, spread: 70, origin: { y: 0.6 } });
          }
          requestAnimationFrame(detectBlow);
        }
        detectBlow();
      } catch (err) {
        alert('Microphone access denied or not supported.');
      }
    }

    startMic();

    document.getElementById('letter').addEventListener('click', () => {
      document.getElementById('letterImage').src = 'YOUR_LETTER_IMAGE_URL_HERE';
      document.getElementById('letterModal').style.display = 'flex';
    });
  </script>
</body>
</html>
